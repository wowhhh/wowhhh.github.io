[toc]


从上面的文章可以了解到，因特网目前有许多的组成部分：大量的应用程序和协议、各种类型的端系统、分组交换机和各种类型的链路级媒体。

## 1：分层的体系结构
### 1：协议分层
为了给网络协议的设计提供一个结构，网络设计者以 **分层**(layer)的方式组织协议以及实现这些协议的网络硬件和软件。
每个协议属于这些层次之一。
某层向它的上一层提供的 **服务**(service)，即所谓一层的服务模型(service model)

一个协议层能够用软件、硬件或两者结合来实现。
  - HTTP和SMTP这样的应用层协议几乎总是在端系统中用软件实现的，运输层协议也是如此
  - 物理层和数据链路层负责处理跨越特定链路的通信，通常是实现在与给定链路相联系的网络接口卡中
  - 网络层经常是硬件和软件实现的混合体
  - 某一层协议的不同部分常常位于这些网络组件的各部分中

协议分层是概念化和结构化的优点。分层提供了一种结构化方式来讨论系统组件。模块化使更新系统组件更为容易。

分层的缺点：
  - 1：可能冗余较低层的功能（???）如，许多协议栈在基于每段链路和基于端到端两种情况下，都提供了差错恢复。
  - 2：某层的功能可能需要健在其他某层提供的信息(如时间戳值)

何为 **协议栈**(protocol stack)
  - 各层的所有协议被称为协议栈
  - 因特网的协议栈由五个层次组成：物理层、链路层、网络层、运输层和应用层

####  应用层
应用层是网络应用程序及它们的应用层协议存留的地方。
例如：HTTP，SMTP和FTP
应用层协议分布在多个端系统上，一个端系统中的应用程序使用协议与另一个端系统中的应用程序交换信息的分组。
位于应用层的信息分组成为报文。

#### 网络层
网路层负责将 **数据报**(datagram)的网络层分组从一台主机移动到另一台主机。
从源主机的因特网运输层协议(TCP或UDP)向网络层递交运输层报文段和目的地址，就相当于寄快递的时候填写目的地址一样。

网络层包括IP协议
  - IP协议定义了在数据报中的各个字段以及端系统和路由器如何作用于这些字段。
  - 网络层的因特网组件必须运行IP协议
  - 网络层还包括路有选择协议

#### 链路层
网络层是通过源于目的地之间的一系列路由器路由数据包。但是网路程必须依靠链路层的服务，去达到分组从一个结点移动到下一个结点。
链路层提供的服务取决于应用于该链路的特定链路层协议。
将链路层分组称之为 **帧**(frame)
链路层的任务可以理解为将整个帧从一个网络结点移动到邻近的网络结点
#### 物理层
物理层的任务是将帧中的一个一个比特从一个结点移动到下一个结点。
此层的协议依然与链路层相关。

### 2：OSI模型
上面讨论的协议栈并不是唯一的，还有七层OSI模型。

  ![](assets/markdown-img-paste-20191125090846505.png)

应用层、表示层、会话层、运输层、网络层、数据链路层和物理层。
#### 表示层
使通信的应用程序能够解释交换数据的含义。这些数据包括数据压缩和数据加密以及数据描述。
#### 会话层
提供了数据交换定界和同步功能，包括了建立检查点和恢复方案的方法。
## 2：封装

  ![](assets/markdown-img-paste-20191125091135720.png)

上图描述的场景如下：数据从源的协议栈向下，接着在链路交换机和路由器的协议栈向上在向下，再向上到达接收端系统的协议栈。
  - 1：路由器和链路层交换机并不实现协议栈中的所有层次

上图描述的一个重要的概念：**encapsulation**
  - 发送主机端(源)：
    - 1：一个 **应用层报文**(application-layer message)(图中的M)被传送给运输层
    - 2：运输层接收到报文后附上附加信息(运输层首部信息，图中的H_t)，该首部将被接收端的运输层使用。也就是说运输层报文段封装了应用层报文，附加的信息比如：允许接收端运输层向上向适当的应用程序交付报文的信息（差错检测位信息）
    - 3：网络层棘手运输层传递的报文段，网络层增加了如源和目的端系统地址等网络层首部信息(H_n)，产生了 **网络层数据报**(network-alyer datagram)
    - 4：上述数据报传递给链路层，链路层增加了它自己的链路层首部信息并创建 **链路层帧**(link-alyer frame)
  - 此时再观察每一层，一个分组具有两种类型的字段：首部字段和 **有效载荷字段**(payload field)，有效载荷字段通常来自上一层分组。

实际的封装过程比上面要复杂的。一个大报文可能被划分为多个运输层的报文段，这些报文段可能被划分为多个网络层数据报，在接收端，必须从其连续的数据报中重构出这样的报文段。
