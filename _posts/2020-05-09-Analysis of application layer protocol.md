---
layout: post
title:  "应用层协议解析"
tags:   应用层 体系结构 TCP UDP 应用层协议
date:   2020-05-09 14:02:25 +0800
categories: [计算机网络]
---

## 1：网络应用程序体系结构

Codeing之前，应当对应用程序有一个宽泛的体系结构计划。但是应用程序的体系结构是不同于网络的体系结构的。
  - 网络体系结构是固定的，为应用程序提供了特定的服务集合
  - **应用程序体系结构** 都是开发者自己来设计的，目的是规定如何在各种端系统去组织该应用程序（每个端系统的code不一样，但是整体的体系结构都是一样的）。主流的两种体系结构：1：客户-服务体系结构；2：对等(P2P)体系结构

- 客户-服务体系结构

  举个栗子：以Google为例，我去打开Google是通过浏览器（我的电脑上的）去请求的，当Google的服务器收到我这边浏览器发过去的请求的时候，Google服务器再发给我称之为响应。

  - 特点：客户的主机并不直接通信；服务器是固定的、大家都知道的IP;

- P2P体系结构

  举个栗子：QQ的面对面快传

## 2： 进程通信
端系统上的程序是如何互相通信的？在操作系统的规定中，进行通信的为进程而非程序，当进程运行在相同的端系统上的时候，他们使用进程间通信机制相互通信。这里提到的进程间通信机制的规则是由端系统上的操作系统去确定的，比如说Android关于IPC的学习和讨论是很深的。

此处仅关注运行在不同端系统上的进程间的通信，如果想了解同一台主机上的进程间通信，去补操作系统叭（难顶）

那么不同端系统上的进程间是如何通信的呢？
  - 通过跨越计算机网络交换 **报文** 相互通信。
### 2.1：客户和服务器进程
因为进程之间通信是成对的，所以要约束一下谁是客户，谁是服务器，怎么约束呢？
>在给定的一对进程之间的通信回话场景中，发起通信（即在该回话开始的时候发起与其他进程的联系）的进程被标识为客户，在会话开始时等待联系的进程是服务器

也就是我们平时说的客户端、服务器端

### 2.2：进程与计算机网络之间的接口
- 套接字(socket)
  - 进程通过socker软件接口向网络发送报文和接收报文
  - 套接字是同一台主机内应用层与运输层之间的接口
  - 套接字也称之为应用程序和网络之间的API

![markdown-img-paste-20200406235626348](https://i.loli.net/2020/09/01/LdI82fxlNWZmtsR.png)

开发者可以控制处在应用层端的socket；但是对运输层段的控制就下面几点
   1：选择运输层协议；2：也许可以设定几个运输层参数

### 2.3：进程寻址
A主机上运行的进程要向B主机上运行的进程发送分组，那B主机的进程就需要一个地址，这样A主机才知道要发给谁。
- 如何标识B主机上的进程（接收进程）
  - 需要定义两种信息，一个是主机的地址，一个是在目的主机中的接收进程的标识符。
- 主机的地址如何标识？
  - **IP** 地址，暂时知道IP地址是一个32Bit的量并且能够唯一标识该主机。
- 目的主机中的接收进程的标识
  - 发送进程还需要知道在接收主机上的接收进程（接收套接字），这是因为一台主机能够运行许多网络应用，所以需要指定哪一个进程去接收。
  - 那么就用 **端口号** (port)去标识。

## 3：应用程序可以使用的运输服务
运输协议有多种，应用开发的时候需要选择一种可用的运输层协议。那如何去挑选需要哪些协议，就需要知道协议都能提供给应用什么服务。可以从以下四个方面分析：可靠数据传输、吞吐量、定时
和安全性。
### 3.1：可靠数据传输
- 什么是可靠数据传输？
  如果一个协议能够将应用程序发送的数据正确完全地交付给接收的应用程序，则称其提供了可靠数据传输。

  相对立的，肯定也有运输协议提供不了可靠数据传输，也就是说发送来的数据可能有一些不能够到达接收进程，这些丢失的数据可能被 **容忍丢失的应用** 所接受的。

### 3.2：吞吐量
可用吞吐量就是发送进程能够向接收进程交付比特的速率。

运输层协议可以确保吞吐量不会低于r比特/秒。

- 区分一下带宽敏感的应用与弹性应用
  - 带宽敏感即对吞吐量有要求的应用程序
  - 弹性应用即能够根据情况或多或少低利用可供使用的吞吐量

### 3.3：定时
保证多长时间内到达接收方，例如：发送方进套接字的每个比特到达接收方的套接字不迟于100ms。

这种对交互式应用很重要，比如和平精英

### 3.4：安全性
运输协议能够为程序提供一种或多种安全性服务。
比如：机密性，加密发送进程传输的所有数据，解密接收进程的数据。

## 4：因特网提供的运输服务
因特网为应用程序提供两个运输层协议，即UDP和TCP，开发的时候就应该选择采用哪种运输协议，每个协议提供的服务也是不同的。
### 4.1：TCP
TCP服务模型包括面向连接服务和可靠数据传输服务。
  - 面向连接的服务：在应用层数据报文开始传输之前，TCP让客户和浏览器互相交换运输层控制信息（握手过程）；此过程提示客户和服务器，要为大量分组的传输做好准备；握手阶段之后，一个TCP连接就在两个进程的套接字之间建立了；此连接是 **全双工** 的，也就是双方都可以在此连接上同时进行报文收发。
  - 可靠数据传输服务：进程可以依靠TCP，无差错并且按照适当顺序交付所有发送的数据。从发送方到接收方可以没有字节的丢失和冗余。
  - 拥塞控制机制：发送方和接收方出现拥塞的时候，此机制会抑制发送进程。
### UDP服务
UDP是一种不提供不必要服务的轻量级运输协议，提供最小服务。
- 无连接（没有握手）
- 不可靠数据传送服务
- 没有拥塞控制机制

## 5：应用层协议
上述讨论的是报文如何从一个进程都另一个进程，那？
- 如何构造上述报文？
- 报文的各个字段的含义？
- 何时发送报文？
这就引入了应用层协议，应用层协议定义了运行在不同端系统上的应用进程如何相互传递报文，它定义了：
  - 1：交换的报文类型，即请求报文还是响应报文
  - 2：报文类型的语法，如报文中的各个字段以及这些字段是如何描述的
  - 3：字段的语义，即字段信息的含义
  - 4：进程何时以及如何发送报文，对报文响应的规则

应用层协议只是网络应用的一部分。
